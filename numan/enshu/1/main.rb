def lu_decompose3x3(matA) #=> [matL, matU]
  # matA = matL * matU
  l11, l21, l31 = matA[0][0], matA[1][0], matA[2][0]
  u12, u13 = (matA[0][1] / l11), (matA[0][2] / l11)
  l22, l32 = (matA[1][1] - l21 * u12), (matA[2][1] - l31 * u12)
  u23 = (matA[1][2] - l21 * u13) / l22
  l33 = matA[2][2] - l31 * u13 - l32 * u23
  return [ [[l11, 0, 0], [l21, l22, 0], [l31, l32, l33]],
           [[1, u12, u13], [0, 1, u23], [0, 0, 1]] ]
end

R1, R3, R4, R0 = 4, 4, 5, 1 #[Ω]
E = 15 #[V]

0.step(by: 0.5, to: 10) { |r2|
  matA = [[R1+r2+R0, -R0, -r2], [-R0, R3+R4+R0, -R4], [-r2, -R4, r2+R4]]
  vecB = [0, 0, E]
  matL, matU = *lu_decompose3x3(matA)
  y1 = vecB[0] / matL[0][0]
  y2 = (vecB[1] - y1*matL[1][0]) / matL[1][1]
  y3 = (vecB[2] - y1*matL[2][0] - y2*matL[2][1]) / matL[2][2]
  i3 = y3 / matU[2][2]
  i2 = (y2 - i3*matU[1][2]) / matU[1][1]
  i1 = (y1 - i3*matU[0][2] - i2*matU[0][1]) / matU[0][0]
  puts "R2 = %4.1f [Ω] => I0 = %6.3f [A]" % [r2, i1 - i2]
  puts "  L = #{matL}"
  puts "  U = #{matU}"
  puts "  x = #{[i1, i2, i3]}"
}

=begin
$ ruby main.rb
R2 =  0.0 [Ω] => I0 = -2.500 [A]
  L = [[5.0, 0, 0], [-1, 9.8, 0], [-0.0, -5.0, 2.4489795918367347]]
  U = [[1, -0.2, -0.0], [0, 1, -0.5102040816326531], [0, 0, 1]]
  x = [0.625, 3.125, 6.125]
R2 =  0.5 [Ω] => I0 = -1.776 [A]
  L = [[5.5, 0, 0], [-1, 9.818181818181818, 0], [-0.5, -5.090909090909091, 2.8148148148148144]]
  U = [[1, -0.18181818181818182, -0.09090909090909091], [0, 1, -0.5185185185185185], [0, 0, 1]]
  x = [0.986842105263158, 2.763157894736842, 5.328947368421053]
R2 =  1.0 [Ω] => I0 = -1.304 [A]
  L = [[6.0, 0, 0], [-1, 9.833333333333334, 0], [-1.0, -5.166666666666667, 3.1186440677966094]]
  U = [[1, -0.16666666666666666, -0.16666666666666666], [0, 1, -0.5254237288135594], [0, 0, 1]]
  x = [1.222826086956522, 2.527173913043479, 4.809782608695653]
R2 =  1.5 [Ω] => I0 = -0.972 [A]
  L = [[6.5, 0, 0], [-1, 9.846153846153847, 0], [-1.5, -5.230769230769231, 3.3750000000000004]]
  U = [[1, -0.15384615384615385, -0.23076923076923078], [0, 1, -0.53125], [0, 0, 1]]
  x = [1.3888888888888888, 2.3611111111111107, 4.444444444444444]
R2 =  2.0 [Ω] => I0 = -0.726 [A]
  L = [[7.0, 0, 0], [-1, 9.857142857142858, 0], [-2.0, -5.285714285714286, 3.5942028985507255]]
  U = [[1, -0.14285714285714285, -0.2857142857142857], [0, 1, -0.536231884057971], [0, 0, 1]]
  x = [1.5120967741935478, 2.2379032258064506, 4.173387096774192]
R2 =  2.5 [Ω] => I0 = -0.536 [A]
  L = [[7.5, 0, 0], [-1, 9.866666666666667, 0], [-2.5, -5.333333333333333, 3.7837837837837847]]
  U = [[1, -0.13333333333333333, -0.3333333333333333], [0, 1, -0.5405405405405405], [0, 0, 1]]
  x = [1.6071428571428568, 2.142857142857142, 3.9642857142857135]
R2 =  3.0 [Ω] => I0 = -0.385 [A]
  L = [[8.0, 0, 0], [-1, 9.875, 0], [-3.0, -5.375, 3.9493670886075947]]
  U = [[1, -0.125, -0.375], [0, 1, -0.5443037974683544], [0, 0, 1]]
  x = [1.682692307692308, 2.0673076923076925, 3.7980769230769234]
R2 =  3.5 [Ω] => I0 = -0.262 [A]
  L = [[8.5, 0, 0], [-1, 9.882352941176471, 0], [-3.5, -5.411764705882353, 4.095238095238095]]
  U = [[1, -0.11764705882352941, -0.4117647058823529], [0, 1, -0.5476190476190477], [0, 0, 1]]
  x = [1.744186046511628, 2.0058139534883725, 3.662790697674419]
R2 =  4.0 [Ω] => I0 = -0.160 [A]
  L = [[9.0, 0, 0], [-1, 9.88888888888889, 0], [-4.0, -5.444444444444445, 4.224719101123595]]
  U = [[1, -0.1111111111111111, -0.4444444444444444], [0, 1, -0.550561797752809], [0, 0, 1]]
  x = [1.7952127659574468, 1.9547872340425534, 3.550531914893617]
R2 =  4.5 [Ω] => I0 = -0.074 [A]
  L = [[9.5, 0, 0], [-1, 9.894736842105264, 0], [-4.5, -5.473684210526316, 4.340425531914893]]
  U = [[1, -0.10526315789473684, -0.47368421052631576], [0, 1, -0.5531914893617021], [0, 0, 1]]
  x = [1.8382352941176472, 1.911764705882353, 3.4558823529411766]
R2 =  5.0 [Ω] => I0 =  0.000 [A]
  L = [[10.0, 0, 0], [-1, 9.9, 0], [-5.0, -5.5, 4.444444444444445]]
  U = [[1, -0.1, -0.5], [0, 1, -0.5555555555555556], [0, 0, 1]]
  x = [1.875, 1.875, 3.375]
R2 =  5.5 [Ω] => I0 =  0.064 [A]
  L = [[10.5, 0, 0], [-1, 9.904761904761905, 0], [-5.5, -5.523809523809524, 4.538461538461538]]
  U = [[1, -0.09523809523809523, -0.5238095238095238], [0, 1, -0.5576923076923077], [0, 0, 1]]
  x = [1.9067796610169492, 1.843220338983051, 3.305084745762712]
R2 =  6.0 [Ω] => I0 =  0.119 [A]
  L = [[11.0, 0, 0], [-1, 9.909090909090908, 0], [-6.0, -5.545454545454545, 4.623853211009175]]
  U = [[1, -0.09090909090909091, -0.5454545454545454], [0, 1, -0.5596330275229358], [0, 0, 1]]
  x = [1.9345238095238093, 1.8154761904761902, 3.2440476190476186]
R2 =  6.5 [Ω] => I0 =  0.168 [A]
  L = [[11.5, 0, 0], [-1, 9.91304347826087, 0], [-6.5, -5.565217391304348, 4.701754385964913]]
  U = [[1, -0.08695652173913043, -0.5652173913043478], [0, 1, -0.5614035087719298], [0, 0, 1]]
  x = [1.9589552238805967, 1.7910447761194028, 3.1902985074626864]
R2 =  7.0 [Ω] => I0 =  0.211 [A]
  L = [[12.0, 0, 0], [-1, 9.916666666666666, 0], [-7.0, -5.583333333333333, 4.773109243697478]]
  U = [[1, -0.08333333333333333, -0.5833333333333334], [0, 1, -0.5630252100840336], [0, 0, 1]]
  x = [1.9806338028169017, 1.769366197183099, 3.1426056338028174]
R2 =  7.5 [Ω] => I0 =  0.250 [A]
  L = [[12.5, 0, 0], [-1, 9.92, 0], [-7.5, -5.6, 4.838709677419356]]
  U = [[1, -0.08, -0.6], [0, 1, -0.564516129032258], [0, 0, 1]]
  x = [1.9999999999999993, 1.7499999999999993, 3.099999999999999]
R2 =  8.0 [Ω] => I0 =  0.285 [A]
  L = [[13.0, 0, 0], [-1, 9.923076923076923, 0], [-8.0, -5.615384615384615, 4.899224806201551]]
  U = [[1, -0.07692307692307693, -0.6153846153846154], [0, 1, -0.565891472868217], [0, 0, 1]]
  x = [2.017405063291139, 1.7325949367088602, 3.0617088607594933]
R2 =  8.5 [Ω] => I0 =  0.316 [A]
  L = [[13.5, 0, 0], [-1, 9.925925925925926, 0], [-8.5, -5.62962962962963, 4.955223880597015]]
  U = [[1, -0.07407407407407407, -0.6296296296296297], [0, 1, -0.5671641791044777], [0, 0, 1]]
  x = [2.033132530120482, 1.7168674698795183, 3.0271084337349397]
R2 =  9.0 [Ω] => I0 =  0.345 [A]
  L = [[14.0, 0, 0], [-1, 9.928571428571429, 0], [-9.0, -5.642857142857142, 5.007194244604316]]
  U = [[1, -0.07142857142857142, -0.6428571428571429], [0, 1, -0.5683453237410072], [0, 0, 1]]
  x = [2.047413793103449, 1.702586206896552, 2.995689655172414]
R2 =  9.5 [Ω] => I0 =  0.371 [A]
  L = [[14.5, 0, 0], [-1, 9.931034482758621, 0], [-9.5, -5.655172413793103, 5.055555555555556]]
  U = [[1, -0.06896551724137931, -0.6551724137931034], [0, 1, -0.5694444444444444], [0, 0, 1]]
  x = [2.0604395604395602, 1.6895604395604393, 2.9670329670329667]
R2 = 10.0 [Ω] => I0 =  0.395 [A]
  L = [[15.0, 0, 0], [-1, 9.933333333333334, 0], [-10.0, -5.666666666666667, 5.100671140939598]]
  U = [[1, -0.06666666666666667, -0.6666666666666666], [0, 1, -0.5704697986577182], [0, 0, 1]]
  x = [2.0723684210526314, 1.6776315789473684, 2.94078947368421]
=end
