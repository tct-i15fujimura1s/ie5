---
mathjax: true
---
{% include mathjax.html %}

## 動画像の符号化
## 1 フレーム間予測符号化
動画像において、１フレーム前の画像の同一位置の画素値を予測に用い、予測値の差を符号化する。
最も簡単な予測方法は前のフレームの画素値をそのまま予測値として使うもので、動く部分が少ない画像の場合は効率の良い圧縮が期待できる。

## 2 動き補償フレーム間予測符号化
画像内の物体の動きが激しい場合、単純なフレーム間予測符号化では予測の精度が低く、高い圧縮効率は期待できない。
このような場合は、前後のフレームを比較して物体の動きを検出し、その動き分だけ前のフレームで予測に用いる画素の位置を補正することで予測の精度と圧縮率の工場が実現できる。
こうした操作を動き補償という。

動き補償における動きの検出方法の代表的なものにブロック・マッチング法がある。
これは画像を適当な大きさごとにブロック化し、ブロック単位でマッチングを行い、動き量を検出する手法である。

## ハフマン符号化
符号割り当て部分の符号化（入力→`冗長度の削減`→`量子化`→`符号割り当て`→出力）
* 濃度やランレングスといった情報源シンボルに符号を割り当てる作業
* 生起確率が高いシンボル→短い符号

### 処理方法

こうした操作を動き補償という。
1. 生起確率の統合
  1. 情報源シンボル $s$ を生起確率 $p_s$ の高い順に並べる
  2. 最も生起確率の低いシンボル二つ $t, u$ を統合して１つのシンボル $v$ とみなし、 $p_v = p_t + p_u$ とする
  3. シンボルを生起確率の高い順に並べなおす
  4. シンボルの数が2つになるまで 2. と 3. を繰り返す
2. 生起確率の分解と符号化
  1. 二つに統合された片方のシンボルに `0` 、 他方に `1` の符号を与える
  2. 統合していったのと逆の流れで、シンボルを分解しながら `0` と `1` の符号を与えていく
  3. 統合されたシンボルがなくなれば終了し、それぞれのシンボルの符号語をそれまでに与えられた `0` `1` の符号を繋げたものとする。

## 修正ハフマン(MH)符号化
ファクシミリの国際規格 G1, G2, G3, G4 のうち現在主流である G3 で採用されている。

ランレングス符号化を基本とし、用意するべき符号語の数を少なくするために、情報源を分割して符号化する方式。

G3 規格では、 A4 版の１走査線は 1728 画素からなり、そのままランレングス符号化すると0から1728までの1729個の符号語が必要。

MH符号化ではランレングス $R$ を 64進数 で次式のように表し、 $M$ と $T$ をそれぞれ別々にハフマン符号化する。

$$ R = 64M + T $$

$M$ を make up 符号、 $T$ を terminating 符号と呼ぶ。 $M = 0$ の時は、 $M$ 符号を伝送しない。
$M = 0$ になる場合が多いので、効率の向上が期待できる。

## MR符号化
画素ではなく、水平ライン上で白黒が切り替わる位置を符号化する。

さらに、直前の水平ラインとの差分をとって効率化を図る。

MR符号化では、MH符号化に比べて50〜70%程度符号量が減少する。

MR符号化では参照ラインを用いて符号化するので、途中で伝送誤りを生じると以降に影響が及ぶ。

これを防ぐため、 $K$ 走査線ごとに1度MH符号化を挿入して、誤りが長く伝搬することを防いでいる。
この $K$ は K ファクタと呼ばれ、標準モードでは $K=2$ 、 高解像度モードでは $K=4$ となる。
($K=2$ の場合、 MR, MH, MR, MH, ... となる)

ディジタル通信路では、通信路側で誤りに対して処置が行われるので、 $K=\infty$ とできる。
これは MMR 符号化 (modified MR coding) と呼ばれ、 G4 で採用されている。

## JPEG
名前の由来は Joint Photographic Coding Experts Group 。

DCT 方式と Spacial 方式がある。

* DCT 方式: 非可逆。 DCT (discrete cosine transform: 離散コサイン変換) を用いる。 Baseline System と Extended System に分類される。
* Spacial 方式: 可逆。 予測符号化の一つ DPCM (differential PCM) を用いる。

1. DCT
  * 各色成分ごとに $8 \times 8$ 画素のブロックに分解
  * 各ブロックを $8 \times 8$ 行列データとして DCT ($8 \times 8$ の DCT 係数になる)
2. 量子化
  * 各色成分ごとに用意した $8\times8$ 量子化テーブルの各係数で各 DCT 係数を除算し、四捨五入して整数化する
  * 高い周波数の成分は認識しにくいので以下のようにするとハフマン符号化での圧縮効率がよくなる
    * 量子化テーブルの低い周波数成分に対応する係数は小さくし、
    * 高い周波数成分に対応する係数は大きくする
  * 量子化テーブルの係数を調整することで圧縮率や画質を自由に調整できる
3. ハフマン符号化
  * データを直流成分と交流成分に分ける
    * 直流成分
      * 前のブロックの直流成分との差分を取る
      * 差分を JPEG で定めたルールに従ってグループ化し、各グループに名前をつける
      * 各グループ名の出現頻度に応じてハフマン符号化する
    * 交流成分
      * 周波数の低い方から順番にジグザグにデータを並べなおす
      * データ値を JPEG で定めたルールに従ってグループ分けし、グループ名をつける。特に0には連続する数に対してもグループ名をつける
      * 各グループ名の出現頻度に応じてハフマン符号化する
