# ネットワークアーキテクチャ 10/23

## 再送制御
* 下位のレイヤでデータが損失/紛失
  * 物理層レベルでビットエラー (データリンク層で破棄)
  * 輻輳

### HDLC
* データリンク層のプロトコル
* データ誤り制御をする
  * ACK/NAK
* 輻輳が発生した時、処理できないときは破棄

### TCPから見たとき
* データが紛失したとき、ACKが帰ってこない

### お約束は
* 送信側
  * TCP層からのデータを送信
  * 一定時間そのデータへのACKが返ってこなかったら再送
* 受信側
  * データが来たら対応するACKを返す

### 場合別
#### 伝送中の紛失
* 受信側: データが来なかったのでACKを返さない
* 送信側: ACKが来ないので再送

#### ACKが紛失/遅延
* 受信側: データが来たのでACKを返す
* 送信側: ACKが来ないので再送
* 受信側: 重複してデータが来たので破棄、ACKは返す
* 送信側: ACKが来たので再送しない

#### 受信側: 重複したらACKを返さない
* 受信側: データが来たのでACKを返す
* ACKが紛失
* 送信側: ACKが来ないので再送
* 受信側: 重複なのでACKを返さない
* 送信側: ACKが来ないので再送

#### ファイアウォールがある場合
SiteAとSiteBが通信する時、SiteBにFWがあり、内→外は通すが外→内はブロックする場合

* SiteB: SYN -> SiteA
* SiteA: SYN/ACK -> SiteB (ブロックされる)
* SiteB: SYN -> SiteA (再送)
* SiteA: SYN/ACK -> SiteB (再送; ブロックされる)
* 互いに再送を何度か繰り返し、通信できない


* SiteB: SYN-SENT のまま
* SiteA: SYN-RECEIVED のまま

### フロー制御
ウィンドウという値を用いる

* スライディング・ウィンドウ: 受信ウィンドウに空きがある場合、次々と送れる
* 送信ウィンドウ: 再送に必要

### 輻輳制御
* 次々送る
* 輻輳が発生すると伝送中に紛失→ACKが返ってこない
  * 時間あたりの伝送量をへらす

#### 紳士協定？
* 輻輳が起きるということは、他の局も通信している
  * AとBがTCPで輻輳制御
  * CとDはUDPでドバドバ通信
  * → AとBが輻輳制御してもどうにもならない
* → 帯域制御の技術 (L1〜L3: ネットワーク層以下)
  * 帯域を公平に割り振る

## IPの復習
* 「同一のネットワーク」＝「同じセグメント」
  * 192.168.24.1/24と192.168.24.10/24は同一のネットワーク
  * ルータを介さない通信では、ネットワーク・フィールドが同じになるようにIPアドレスを割り振る
  * 「同じネットワーク」は違う意味

### 同一ネットワークの判定 (ネットワーク・フィールドの求め方)
* サブネットマスク /24 = 255.255.255.0
* サブネットマスク AND IPアドレス
  * A: 192.168.24.1 → 192.168.24.0
  * B: 192.168.24.10 → 192.168.24.0
  * C: 192.168.25.1 → 192.168.25.0
* ネットワーク・フィールドが同じなら同一ネットワーク
  * AとBは同じセグメント、Cは別のセグメント
  * ネットワークが192.168.24.0/24のアドレスは192.168.24.0〜192.168.24.255の256個

### ネットワークの構築方法
#### 一番簡単な場合
* ２台のホストをケーブルで接続
* 中継装置なし

#### 小規模、家庭向けやSOHO
* Small Office Home Office
* ISP
  * モデム, M/C, DSU or ONU
    * ブロードバンドルータ
      * PC
      * プリンタ
      * サーバPC
