# ネットワークアーキテクチャ 12/18

## Ethernet
### ブロードキャスト　ドメイン
* ブロードキャストが届く範囲
* IPにおけるセグメント
* ルータはブロードキャストドメインを分割する

### コリジョン　ドメイン
* ユニキャストが衝突する範囲
* Ethernetは電気回路
* 例 10BASE5（バス型）接続では、すべてのホストは並列に接続される
  * ホストA, B, C
    * ホストA: 送信、ホストB, C: 受信のとき
      * ホストAがHの信号を送るとき、B,Cの電圧は5Vになる
    * ホストA, B: 送信、ホストC: 受信のとき
      * ホストAがH、ホストBがLの信号を送るとき、Cの電圧は5Vにならない
      * ホストAでも、5Vにならないからコリジョンが起きたことを検出できる

### ブリッジ
* コリジョンドメインを分割する
  * ユニキャストを送るホストを減らす
* ホストを左右に分ける
  * 学習して、フレームを送信するグループを選ぶ
    * 左からホストAからのフレームが来たら、ホストAは左にあると学習
  * ユニキャストのとき
    * 左→左: 左だけに送信
    * 左→右: 右だけに送信
    * 学習していないホストへ: 左にも右にも送信
  * ブロードキャストのとき
    * 左にも右にも送信

### L2SW (現在主流のブリッジ)
* マルチポート版のブリッジ
  * いくつもケーブルを挿せる
* ホストを複数のグループに分ける
* フレームが来ると学習してFDBに登録する


| MAC | ポート |
| A | 1 |
| B | 1 |
| C | 2 |


* 動作
```
received(frame from port P from host A to host B):
  FDB[A] = P
  if B in FDB:
    send(frame to port FDB[B])
  else:
    send(frame to all port)
```

### VLAN
* L2SWの機能
* ブロードキャストドメインを仮想的に分割
* VLAN同士は直接通信できない
* 例:
  * VLAN1: A, B
  * VLAN2: C, D
  * 等価な構成
    * L2SW1: A, B
    * L2SW2: C, D
  * A→B: 可能
  * A→C: VLAN同士をルータで接続する

### L3SW
* 高速に動作する、ルータの一種
* ルータ+L2SWと同じような感じ
  * VLAN機能がある
* 内部にFDB+ARPテーブルを持つ


| IP | MAC | ポート |
| a | A | 1 |
| b | B | 2 |
| c | C | 3 |


* できる限りハードで処理
  * ハードで出来ないときだけ、割込を入れてCPUで処理
* ホストAからホストCへの通信
  * ホストA→L3SW: `[from A to L3SW][from a to c][data][trailer]`
  * L3SW→ホストC: `[from L3SW to C][from a to c][data][trailer]`
  * Ethernetヘッダを機械的に書き換えるだけ→高速

## 教科書 P290
* Ethernetといえば
  * CSMA/CD ? ←10Gbps規格では採用されていない
    * CS（使われているか調べる）・・・時間がかかる(1ms程度)
      * 10Gbpsでは、1msで10Mbを送信できる
    * CSMA/CDは半二重の規格
      * 半二重だと衝突が発生する
      * 10Gbps規格は全二重のみ、衝突は発生しない

### 全二重と半二重
* 全二重: 送受信を同時にできる
  * 例：山陽本線・・・線路が二本あるので、上り下りが同時に通れる
* 半二重: 同時に出来ない
  * 例：岩徳線・・・線路が一本しかないので、上り下りが同時に通れない
